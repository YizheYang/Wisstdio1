# 前言

​		选择了第二个级别的考核难度。第一反应还是感觉挺有意思的，以前就有过类似的想法但因为各种因素总是不了了之。

# 开始

## 第一周 ##

### 0x01.设置布局

​		由于已经提前熟悉过Android Studio的操作，于是直接开始打码。我认为设计软件的第一件事就是要理清思路；而最开始的地方应该就是用户第一眼看到的地方。所以要先在脑海中有个软件成型后的大概的构思。我的想法是每列三个图片，一列一列下来，然后把它们整齐的码在一起。在参考了《第一行代码》后，开始着手做布局文件。先在主界面做个线性布局，放上一个progressbar，然后再在里面添加一个recyclerview以便实现滑动浏览。新增了一个自定义控件，里面设了一个imageview来显示图片和一个TextView来显示作者信息。这样布局方面就大功告成了。

### 0x02.查看接口

​		接下来要做的就是挑选一个网站并且看看它所返回的数据的什么格式的。在这里我选择了第一个网站，按照网站的提示试了下它提供的查询接口，确认返回的内容是一张随机图片的地址以及它相关的消息。在这里没有选择返回多张图片一方面是因为一开始按照书里前面的示范已经实现了，另一方面是因为对读取json对象不熟，想着先把功能实现了再说，后面有时间再改。

### 0x03.网络请求

​		本来是想用书里推荐的okhttp，但是后来上网一查这个好像属于框架，于是又改成了最初的httpURLconnection。一开始写好函数后，输入网址总是不返回空白，然后才想起来返回的只是一个图片的地址，还得写一个函数解析这个地址才能得到要的数据。

## 第二周

### 0x01.完善功能

​		这周将上周未完成的想法实现了，例如一些基础的组件排版，基本的类的编写，解析网址获得对象等。实现了获取的图片的网格流布局显示。在其中研究了handler机制，基本实现了图片和信息的显示。一开始是选择了一次性加载完一定数量的数据再进行显示，这样显得等待的时间较久，于是后来改成获取一张刷新一张，这样看起来会快一点。但是在内存占用上，还是处于一个较高的水平。

### 0x02.下拉刷新，上拉加载更多

​		解决了数据的获取和显示后，准备开始着手解决这个难一点的问题。一开始下拉刷新是使用了swipe组件，后面发现了recyclerview 的canScrollVertically()方法，就又用回这个更为基础的方法。目前在做的功能点在于滑动的反弹效果。

## 第三周

### 0x01.优化显示效果（未成功）

​		这周想要完成上周未完成的滑动反弹效果，但是试了好久都做不出来，所以转为先解决保存图片的功能。

### 0x02.点击放大图片

​		新建了一个activity用来显示放大的图片，使用了显式启动并且将图片的内容传了进去。然后利用item保存到本地。

### 0x03.点击放大图片（续）

​		在上一个思路中发现intent只能传少量的数据，对于较大的图片是传不进去的。于是换了个思路，改为使用dialog显示放大后的图片。同时自定义了recyclerview的点击事件，让每个imageitem被点击的时候能够显示这个dialog。然后设置这个放大了的图片的单击事件为返回，长按事件为保存。返回事件的逻辑是让这个dialog消失。美中不足的就是显示放大的图片下面总会有一个加载圈在转，研究了好久都不知道怎么解决，只能暂时将就一下。

### 0x04.保存图片

​		保存图片一开始的思路是获取dialog里的imageview的bitmap然后通过文件字节流保存下来。但是遇到了三个问题：1，从imageview获取图片的话没法获取到它的网址信息；2，保存不下来；3，保存下来后总是在系统找不到图片。对于第一个问题，我最后选择在recyclerview的点击显示dialog事件中，同时将该imageitem的position设为该imageview的tag，这样通过imageview的gettag()方法得到位置后直接从图片数组里读取就好了，简单明了又速度快。第二个问题找了一天，一开始连保存都不行，后来解决了什么动态权限啊、读不到文件啊、无法创建文件啊、应用读写限制啊等等问题而能保存后，遇到了第三个问题。就在放弃了准备睡觉前，瞥见一个帖子，发现原来系统已经把保存图片的接口写好了，就是MediaStore.Images.Media.insertImage()这个方法。这个方法不仅能保存，还能显示在相册里，只要发送广播刷新一下就好。于是成功完成了保存的整个功能。真是柳暗花明又一村。

## 第四周

### 0x01.点击放大图片（再续）

​		觉得那个加载的圆圈一直在转很不顺眼，于是干脆把整个dialog‘重新弄了一遍，将普通dialog改为alertdialog，将保存图片的功能放在按钮上。

### 0x02.保存图片（续）

​		今天开始搞数据库，具体是在保存图片的时候将该图片的路径，信息，网址都存到数据库里。

### 0x03.加载图片（升级版）

​		由于要有断网的时候加载本地图片的功能，所以将加载图片的函数改了一下，并且新增了一个判断是否联网的函数。如果检测到机器没有联网，则取出数据库里已经保存的图片的地址并且加载到数组中。优化了很多相关的判断flag。

### 0x04.下拉刷新，上拉加载更多（续）

​		下拉刷新：本来想使用自己重写的recyclerview，但是效果不理想，最后选择改回了swiperefreshlayout偷懒。

​		上拉加载更多：优化了逻辑。勉强实现了这个功能，但是效果不是很理想。

### 0x05.一点想法

​		剩最后一个星期了，功能已经实现了九成，但是优化却做得不好。而且尤其是一些变量名函数名还是按照以往的坏习惯命名的，这两天要重构一下。除此之外代码里也没有注释，这几天也要补上。有预感做不到完美，只能尽力而为。

## 第五周

### 0x01.下拉刷新，上拉加载更多（终）

​		最后做不出来，只能实现勉强的功能，但是很容易卡住。

### 0x02.图片三级缓存（未完成）

​		本来想换图片三级缓存，但是尝试了一下感觉剩下的时间不够做完，所以就只能放弃了，导致整个程序滑动起来会卡。

### 0x03.本地查看升级

​		增加了“查看已保存的图片”菜单，并且在里面新增本地图片删除的功能，并且可以在删除后有“后悔药”可吃，删除后仍然可以在界面上保存回来。

### 0x04.优化保存图片逻辑

​		在图片已经存在的情况下不再重复保存，而是显示图片已经存在。

### 0x05.完成注释和代码格式化

​		如题。

# 结尾

​		自我感觉完成度是90吧，唯二缺陷的点一个是上拉加载更多的框架没做好，另一个是图片的三级缓存。然而这两个是影响用户体验的两大重点。因此现在后悔不已，但是也没有办法。另外没有完成更多的功能，只做到了要求的点，整体显得有点简陋。不过鉴于自己是个刚入门的新手，倒也较为满足。在这个月里我接触了大量关于安卓开发的基础知识，也算是圆了以前的一个梦想，挺开心有这个机会的，希望接下来能做的更好。
